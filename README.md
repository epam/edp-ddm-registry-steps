# registry-steps

### Overview

* The main purpose of the registry-steps library is to provide BDD step definitions to use them in registry BDD tests;
* included all dependencies needed for registry BDD tests.

### Steps list
* Кроки для написання тестів можна використовувати із будь-якими анотаціями фреймворку Cucumber у тій послідовності, яка необхідна
* Кожен файл із тестом повинен починатись із вказання мови, яку використовують для написання тесту `# language: uk` та зі слова `Функціонал` після якого вказується назва функціональності, яка перевіряється
* Далі вказується ключове слово `Сценарій`, в якому описано сценарій який перевіряється
* Після сценарію використовуються кроки тесту з анотаціями, які наведені нижче
* Приклади тестів наведено після опису кроків доступних для використання у сценаріях тестування

#### На початку тесту використовуються кроки із наступними анотаціями, які описують передумову початку теста `@Дано`,`@Припустимо`, `@Припустимо, що`, `@Нехай`
* Якщо передумов декілька, використовують анотації `@І`, `@А також`, `@Та`
#### Далі у тесті використовують анотації `@Коли`, `@Якщо`, які описують необхідні дії для виконання тесту
* Якщо кроків декілька, то анотації `@Коли`, `@Якщо` повторюють необхідну кількість раз
* Якщо крок повинен виконувати декілька дій, то використовують анотації `@І`, `@А також`, `@Та`
#### В кінці тесту використовують крок, який описує очікуваний результат тесту з анотаціями `@То`, `@Тоді`
* Якщо очікуваних результатів декілька, тоді використовують анотації `@І`, `@А також`, `@Та`

### Нижче наведено кроки, які імплементовані у бібліотеці `registry-steps`

#### Кроки, які використовуються для перевірки розгорнутої моделі даних та згенерованих запитів для пошуку даних

* @Дано("користувачу {string} доступна розгорнута модель даних з переліком таблиць та згенерованими запитами доступу та пошуку даних")
  * Для змінної `string` необхідно вказати ім'я користувача кабінету посадової особи, яке буде вказано у `user.json` файлі
  * `user.json` файл необхідно додати до репозиторію `registry-tests` за наступним шляхом `\src\test\resources\properties\users.json`  
  * дані атрибутів заповнюються згідно даних ключа, який необхідно додати до репозиторію `registry-tests` за наступним шляхом `\src\test\resources\files\keys\Key-6.dat`   
    drfo, edrpou, fullName, name, password (конвертується у base64), provider  
  Приклад `user.json` файлу наведено нижче
```
    {
      "auto-user-data": {
      "login": "auto-user-data",
      "realm": "-officer-portal",
      "clientId": "officer-portal",
      "realmRoles": [
        "officer"
        ],
      "attributes": {
      "drfo": [
        "1010101014"
        ],
      "edrpou": [
        "34554362"
        ],
      "fullName": [
        "Сидоренко Василь Леонідович"
        ]
      },
      "key": {
        "name": "Key-6.dat",
        "password": "MTIz",
        "provider": "Тестовий ЦСК АТ \"ІІТ\""
        }
    }
```
* @Коли("користувач {string} виконує запит пошуку {string} з параметрами")
  * Для першої змінної `string` необхідно вказати ім'я користувача кабінету посадової особи, яке буде вказано у `user.json` файлі
  * Для другої змінної `string` необхідно вказати endpoint на який буде відправлено запит методом GET
  * Нижче цього кроку необхідно у вигляді таблиці вказати назву параметра та його значення  
    `| параметр | значення |`  
    Приклад:  
```
     Коли користувач "auto-user-data" виконує запит пошуку "academic-year-name-contains" з параметрами
       | name | 2022 |
```
* @Коли("користувач {string} виконує запит пошуку {string} без параметрів")
  * Для першої змінної `string` необхідно вказати ім'я користувача кабінету посадової особи, яке буде вказано у `user.json` файлі
  * Для другої змінної `string` необхідно вказати endpoint на який буде відправлено запит методом GET
* @Тоді("результат запиту містить наступні значення {string} у полі {string}")
  * Для першої змінної `string` необхідно вказати назву параметра із тіла відповіді
  * Для другої змінної `string` необхідно вказати значення параметра із тіла відповіді  
    Приклад:
```
      Тоді результат запиту містить наступні значення "2022" у полі "name"
```
* @Тоді("дата модель повертає точно заданий json нижче:")
  * Нижче цього кроку необхідно у вигляді строки вказати очікувані дані отримані у відповідь на запит    
    Приклад:
```
      Тоді дата модель повертає точно заданий json нижче:
      | [{"cnt":1,"eduOrganizationIdExternal":173268}] |
```
* @Тоді("дата модель повертає json з файлу {string}")
  * Для змінної `string` необхідно вказати шлях до json файлу із очікуваним результатом
    Приклад:
```
     Тоді дата модель повертає json з файлу "features/data/search-conditions/edu-status-name/edu_status_name_read_all.json"
```
* @Тоді("дата модель повертає json, який містить точно наступні дані, ігноруючі невказані:")
  * Нижче цього кроку необхідно у вигляді строки вказати очікувані дані отримані у відповідь на запит  
    Приклад:
``` 
     Тоді дата модель повертає json, який містить точно наступні дані, ігноруючі невказані:
      | [{"constantCode": "INCLUSIVE_TYPE", "name": "Інклюзивний"}] |
```  
* @Тоді("дата модель повертає точно заданий json з файлу {string}, ігноруючі невказані")
  * Для змінної `string` необхідно вказати шлях до json файлу із очікуваним результатом
    Приклад:
``` 
     Тоді дата модель повертає точно заданий json з файлу "features/data/search-conditions/doc-type/doc_type_read_all.json", ігноруючі невказані
``` 

#### Кроки, які використовуються для перевірки розгорнутих бізнес-процесів та форм регламенту реєстру

* @Дано("регламент реєстру розгорнуто")
* @Коли("адміністратор регламенту {string} отримує наявні бізнес-процеси та відповідні їм форми через сервіси платформи")
  * Для змінної `string` необхідно вказати ім'я адміністратора реєстру, яке буде вказано у `user.json` файлі
    Приклад `user.json` файлу наведено нижче
```
{
   "auto-user": {
    "login": "auto-bpms",
    "realm": "-admin",
    "clientId": "camunda-cockpit",
    "realmRoles": [
      "camunda-admin"
    ],
    "realmClientsDictionary": {
      "admin": [
        {
          "clientId": "camunda-cockpit"
        }
      ]
    },
    "attributes": {}
  }
}
``` 
* @Тоді("він переконується, що бізнес-процеси та їх форми доступні кінцевому користувачу")

#### Кроки, які використовуються для перевірки бізнес-процесів у кабінетах посадової особи та користувача послуг

* @Дано("користувач {string} успішно увійшов у кабінет посадової особи")
  * Для змінної `string` необхідно вказати ім'я користувача кабінету посадової особи, яке буде вказано у `user.json` файлі
  * `user.json` файл необхідно додати до репозиторію `registry-tests` за наступним шляхом `\src\test\resources\properties\users.json`
  * дані атрибутів заповнюються згідно даних ключа, який необхідно додати до репозиторію `registry-tests` за наступним шляхом `\src\test\resources\files\keys\Key-6.dat`   
    drfo, edrpou, fullName, name, password (конвертується у base64), provider  
    Приклад `user.json` файлу наведено нижче
```
    {
      "auto-user-officer": {
      "login": "auto-user-officer",
      "realm": "-officer-portal",
      "clientId": "officer-portal",
      "realmRoles": [
        "officer"
        ],
      "attributes": {
      "drfo": [
        "1010101014"
        ],
      "edrpou": [
        "34554362"
        ],
      "fullName": [
        "Сидоренко Василь Леонідович"
        ]
      },
      "key": {
        "name": "Key-6.dat",
        "password": "MTIz",
        "provider": "Тестовий ЦСК АТ \"ІІТ\""
        }
    }
```
* @Та("бачить доступний процес {string}")
  * Для змінної `string` необхідно вказати назву процесу, який тестується
* @Коли("користувач ініціює процес {string}")
  * Для змінної `string` необхідно вказати назву процесу, який тестується
* @Коли("бачить форму {string} із кнопкою "Далі" яка {booleanValue}")
  * Для змінної `string` необхідно вказати назву форми, яку бачить користувач
  * Змінна `booleanValue` може приймати значення `активна` або `не активна`
* @Коли("бачить форму {string} без кнопки "Далі"")
  * Для змінної `string` необхідно вказати назву форми, яку бачить користувач
* @Коли("бачить передзаповнені поля із даними$")
  * Дані для заповнення форми повинні бути додані в тесті у вигляді таблиці з наступною структурою
    * `| name             | type        | value                |`
    * name - це назва елементу форми
    * type - тип елементу форми, можливі значення `radiobutton`, `RADIOBUTTON`, `checkbox`, `CHECKBOX`, `input`, `INPUT`, `select`, `SELECT`, `datetime`, `DATETIME`
    * value - дані, якими заповнено елемент на формі
* @Коли("користувач заповнює форму даними$")
  * Дані для заповнення форми повинні бути додані в тесті у вигляді таблиці з наступною структурою
    * `| name             | type        | value                |`
    * name - це назва елементу форми
    * type - тип елементу форми, можливі значення `radiobutton`, `RADIOBUTTON`, `checkbox`, `CHECKBOX`, `input`, `INPUT`, `select`, `SELECT`, `datetime`, `DATETIME`
    * value - дані, якими необхідно заповнити елемент на формі
* @І("додає запис до {string} таблиці із даними")
  * Для змінної `string` необхідно вказати назву таблиці (елемент editgrid на формі) яка заповнюється даними
* @Та("натискає кнопку "Далі"")
* @Та("на формі {string} бачить повідомлення {string} з текстом:")
* @Коли("пересвідчується в правильному відображенні введених даних на формі {string}")
  * Для змінної `string` необхідно вказати назву форми підпису даних
* @Коли("підписує дані")
* @Тоді("процес закінчено успішно й задача {string} відображається як виконана у переліку задач")
  * Для змінної `string` необхідно вказати назву виконаної задачі
* @Тоді("послуга {string} має ідентифікатор {string}")
  * Для першої змінної `string` необхідно вказати назву послуги
  * Для другої змінної `string` необхідно вказати ідентифікатор послуги


#### Приклад тесту для перевірки розгорнутої моделі даних та згенерованого запиту
```
Функціонал: Створити endpoint для заповнення поля 'Тип заяви' з підтримкою EQUALS

 Структура сценарію: [EQUALS] Перевірка запиту пошуку за полем 'Тип заяви' та порівняння значень в обраних параметрах результату
  Дано користувачу "auto-user-officer" доступна розгорнута модель даних з переліком таблиць та згенерованими запитами доступу та пошуку даних
  Коли користувач "auto-user-officer" виконує запит пошуку "application-type-equals" з параметрами
   | constantCode | <constantCode> |
  Тоді результат запиту містить наступні значення "<constantCode>" у полі "constantCode"
  А також результат запиту містить наступні значення "<applicationTypeName>" у полі "name"
  Приклади:
   | constantCode | applicationTypeName                         |
   | ENROLLMENT   | Зарахування в ЗЗСО                          |
   | EXCLUSION    | Відрахування з ЗЗСО                         |
   | TRANSFER     | Переведення з класу в клас в межах паралелі |
```

#### Приклад тесту для перевірки бізнес-процесу
```
Функціонал: Як чиновник-уповноважена особа ЗО, я хочу мати можливість ініціювати процес створення класів

  Сценарій: [POSITIVE] Перевірка бізнес-процесу "1.06 Створення класів"
    Дано користувач "auto-user-officer" успішно увійшов у кабінет посадової особи
    Та бачить доступний процес "1.06 Створення класів"
    Коли користувач ініціює процес "1.06 Створення класів"
    Та бачить форму "Внести дані про клас" із кнопкою "Далі" яка не активна
    І користувач заповнює форму даними
      | name                                            | type     | value       |
      | Назва ЗЗСО                                      | select   | TESTSCHOOL  |
      | Навчальний рік та форма навчання (інституційна) | select   | 2021-2022   |
      | Ознака клас-комплекту                           | checkbox | Ні          |
      | Паралель                                        | select   | 9           |
      | Назва класу                                     | input    | А           |
      | Керівник                                        | input    | test        |
      | Тип класу                                       | select   | Спеціальний |
      | Мова навчання                                   | select   | українська  |
    І натискає кнопку "Далі"
    А також пересвідчується в правильному відображенні введених даних на формі "Підписати дані про клас"
    Та підписує їх
    Тоді процес закінчено успішно й задача "Підписати дані про клас 9 А за допомогою КЕП" відображається як виконана у переліку задач
```
#### Приклад тесту для розгортання регламенту
```
Функціонал: Розгортання регламенту  

 Сценарій: Перевірка успішного розгортання регламенту та доступності бізнес процесів та їх форм у реєстрі  
  Дано регламент реєстру розгорнуто  
  Коли адміністратор регламенту "auto-user" отримує наявні бізнес процеси та відповідні їм форми через сервіси платформи  
  Тоді він переконується, що бізнес процеси та їх форми доступні кінцевому користувачу
```

### Test execution

* Tests could be run via maven command:
  * `mvn verify` OR using appropriate functions of your IDE.

### License

The registry-steps is Open Source software released under
the [Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0).

